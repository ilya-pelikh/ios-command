const createExploit = (request, count) => {
    return `
    function setNativeValue(element, value) {
      let lastValue = element.value;
      element.value = value;
      let event = new Event("input", { target: element, bubbles: true });
      event.simulated = true;
      let tracker = element._valueTracker;
      if (tracker) {
          tracker.setValue(lastValue);
      }
      element.dispatchEvent(event);
    } 

    function load () {
      const textarea = document.querySelector('#chat-input')

      return new Promise(res => {
        var input = document.getElementById('chat-input');
        
        setNativeValue(input, "${request}");
        
        const inputIcon = document.querySelector('div[aria-disabled="false"]')
        inputIcon.click()


        const interval = setInterval(() => {
            const node = document.querySelector('div[role=button]>div>.ds-icon>svg')

            if (node) {
              clearInterval(interval)
              const result = Array.from(document.querySelectorAll('.ds-markdown'))[${count}].innerText.replaceAll('\\n', ' ')
              res(result)
            }
        }, 2000)

      })
    }

    load()
    `
}

module.exports = {
    createExploit
}

